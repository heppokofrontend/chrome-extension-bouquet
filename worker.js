(()=>{"use strict";const t=[];chrome.runtime.onMessage.addListener((async(t,e)=>{if("number"!=typeof e.tab?.id||"number"!=typeof e.tab?.windowId)return;const{type:a}=await chrome.windows.get(e.tab?.windowId);chrome.tabs.sendMessage(e.tab.id,{task:"pageload",windowType:a})})),chrome.runtime.onConnect.addListener((e=>{e.onMessage.addListener((async({task:e,data:a})=>{switch(e){case"windowOpen":(t=>{const{windowId:e,type:a,rows:i,cols:o,targets:h}=t,s="popup"===a;(async()=>{const t=await chrome.windows.get(e);await chrome.windows.update(e,{state:"maximized"});const d={maxWidth:t.width,maxHeight:t.height},r=d.maxWidth,n=d.maxHeight,c=await chrome.tabs.query({windowId:e}),{width:w,height:m}=s?{width:Math.ceil(r/o),height:Math.ceil(d.maxHeight/i)}:((t,e,a)=>{let{width:i,height:o}=t<4?{width:e/t,height:a}:{width:e/t,height:(()=>{const i=e/t*.5625+39+140;return a/2<i?i:a/2})()};if(500<i)return{width:Math.ceil(i),height:Math.ceil(o)};let h=t;for(;i<500;){if(h--,0===h){i=500;break}i=e/h}return{width:Math.ceil(i),height:Math.ceil(o)}})(c.length,d.maxWidth,d.maxHeight),g={top:0,left:0,width:w,height:m};for(const t of c)if("number"==typeof t.id){const e=await chrome.windows.create({url:t.url,type:a,...g});h.push(e.tabs[0].id),chrome.tabs.remove(t.id),g.left+=w,r<=g.left&&(g.left=0,g.top+=g.height),n<g.top+100&&(g.top=0)}(await chrome.windows.create({url:"./controller.html",type:"popup",width:330,height:290,focused:!0})).alwaysOnTop=!0})()})({...a,targets:t});break;case"gather":await(async t=>{const e=await chrome.windows.create({state:"maximized",focused:!0});for(const a of t)try{await chrome.tabs.move(a,{index:-1,windowId:e.id})}catch{}e.tabs?.[0].id&&chrome.tabs.remove(e.tabs[0].id)})(t),t.length=0;break;default:if(e.startsWith("video-"))for(const i of t)chrome.tabs.sendMessage(i,{task:e,data:a})}}))}))})();